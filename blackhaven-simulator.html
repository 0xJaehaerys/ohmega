<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackhaven Protocol Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0b0d;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        
        .wallet {
            background: #1a1d23;
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .wallet h2 {
            color: #00d4ff;
            margin-bottom: 15px;
        }
        
        .balance-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #0a0b0d;
            border-radius: 8px;
        }
        
        .balance-value {
            color: #4ade80;
            font-weight: bold;
        }
        
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .product {
            background: #1a1d23;
            border: 1px solid #2d3139;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s;
        }
        
        .product:hover {
            transform: translateY(-2px);
            border-color: #00d4ff;
        }
        
        .product h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }
        
        .product-info {
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #aaa;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #888;
            font-size: 0.9em;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            background: #0a0b0d;
            border: 1px solid #2d3139;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 16px;
        }
        
        .button {
            width: 100%;
            padding: 12px;
            background: #00d4ff;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .button:hover {
            background: #00a8d4;
            transform: translateY(-1px);
        }
        
        .button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        
        .treasury {
            background: #1a1d23;
            border: 2px solid #4ade80;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .treasury h2 {
            color: #4ade80;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            background: #0a0b0d;
            border-radius: 10px;
            padding: 5px;
            margin: 10px 0;
        }
        
        .progress {
            background: linear-gradient(90deg, #00d4ff, #4ade80);
            border-radius: 8px;
            height: 20px;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .timeline {
            background: #1a1d23;
            border: 1px solid #2d3139;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .timeline h3 {
            color: #fbbf24;
            margin-bottom: 15px;
        }
        
        .time-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-button {
            flex: 1;
            padding: 10px;
            background: #2d3139;
            border: 1px solid #444;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-button:hover {
            background: #3d4149;
            border-color: #00d4ff;
        }
        
        .events {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #0a0b0d;
            border-radius: 8px;
        }
        
        .event {
            padding: 8px;
            margin: 5px 0;
            background: #1a1d23;
            border-radius: 6px;
            font-size: 0.9em;
            border-left: 3px solid #00d4ff;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #1a1d23;
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal h3 {
            color: #00d4ff;
            margin-bottom: 20px;
        }
        
        .close {
            float: right;
            font-size: 28px;
            color: #888;
            cursor: pointer;
        }
        
        .close:hover {
            color: #fff;
        }
        
        .positions {
            background: #1a1d23;
            border: 1px solid #2d3139;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .positions h3 {
            color: #f59e0b;
            margin-bottom: 15px;
        }
        
        .position-item {
            background: #0a0b0d;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #2d3139;
        }
        
        .position-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .position-details {
            font-size: 0.9em;
            color: #888;
        }
        
        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        
        .tag-hpn {
            background: #4ade80;
            color: #000;
        }
        
        .tag-bond {
            background: #f59e0b;
            color: #000;
        }
        
        .tag-hvn {
            background: #00d4ff;
            color: #000;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: #0a0b0d;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00d4ff;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚Çç·ê¢. .·ê¢‚Çé Blackhaven Protocol Simulator</h1>
        <p class="subtitle">Interactive simulation of MegaETH's liquidity engine</p>
        
        <!-- Timeline -->
        <div class="timeline">
            <h3>‚è∞ Simulation Time</h3>
            <div class="time-controls">
                <button class="time-button" onclick="advanceTime(1)">+1 Day</button>
                <button class="time-button" onclick="advanceTime(30)">+1 Month</button>
                <button class="time-button" onclick="advanceTime(365)">+1 Year</button>
                <button class="time-button" onclick="resetSimulation()">Reset</button>
            </div>
            <p>Current Day: <span id="currentDay">0</span></p>
            <div class="events" id="events">
                <div class="event">Simulation started</div>
            </div>
        </div>
        
        <!-- Your Wallet -->
        <div class="wallet">
            <h2>üí∞ Your Wallet</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">USDM</div>
                    <div class="stat-value" id="usdmBalance">100,000</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">MEGA</div>
                    <div class="stat-value" id="megaBalance">10,000</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">HVN</div>
                    <div class="stat-value" id="hvnBalance">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">RBT</div>
                    <div class="stat-value" id="rbtBalance">0</div>
                </div>
            </div>
        </div>
        
        <!-- Products -->
        <div class="products">
            <!-- HPN Product -->
            <div class="product">
                <h3>üõ°Ô∏è Haven Protected Notes (HPN)</h3>
                <div class="product-info">
                    Principal-protected deposits. Get NFT position.<br>
                    ‚Ä¢ No market risk<br>
                    ‚Ä¢ Earn yield + MEGA Points<br>
                    ‚Ä¢ 7-day cooldown on exit
                </div>
                <div class="input-group">
                    <label>Deposit Amount (USDM only)</label>
                    <input type="number" id="hpnAmount" value="10000" min="1000">
                </div>
                <div class="input-group">
                    <label>Term</label>
                    <select id="hpnTerm">
                        <option value="90">3 Months (8% APY)</option>
                        <option value="180">6 Months (12% APY)</option>
                        <option value="365">1 Year (15% APY)</option>
                    </select>
                </div>
                <button class="button" onclick="createHPN()">Create HPN Position</button>
            </div>
            
            <!-- Bonds Product -->
            <div class="product">
                <h3>üìà Fixed-Term Bonds</h3>
                <div class="product-info">
                    Get discounted RBT with vesting.<br>
                    ‚Ä¢ 10% discount on RBT<br>
                    ‚Ä¢ Linear vesting<br>
                    ‚Ä¢ Additional rewards
                </div>
                <div class="input-group">
                    <label>Bond Asset</label>
                    <select id="bondAsset">
                        <option value="usdm">USDM</option>
                        <option value="mega">MEGA</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Amount</label>
                    <input type="number" id="bondAmount" value="10000" min="100">
                </div>
                <div class="input-group">
                    <label>Vesting Period</label>
                    <select id="bondVesting">
                        <option value="7">7 Days (5% discount)</option>
                        <option value="30">30 Days (10% discount)</option>
                        <option value="90">90 Days (15% discount)</option>
                    </select>
                </div>
                <button class="button" onclick="createBond()">Create Bond</button>
            </div>
            
            <!-- HVN Product -->
            <div class="product">
                <h3>üó≥Ô∏è HVN Governance Token</h3>
                <div class="product-info">
                    Buy HVN on Baseline Markets.<br>
                    ‚Ä¢ Guaranteed price floor (BLV)<br>
                    ‚Ä¢ Non-liquidatable leverage<br>
                    ‚Ä¢ Stake for sHVN rewards
                </div>
                <div class="stat-box" style="background: #1a1d23; margin: 10px 0;">
                    <div class="stat-label">Current Price / BLV</div>
                    <div class="stat-value">$<span id="hvnPrice">1.00</span> / $<span id="hvnBLV">0.90</span></div>
                </div>
                <div class="input-group">
                    <label>Buy Amount (USDM)</label>
                    <input type="number" id="hvnBuyAmount" value="10000" min="100">
                </div>
                <button class="button" onclick="buyHVN()">Buy HVN</button>
                <button class="button" style="margin-top: 10px; background: #4ade80;" onclick="stakeHVN()">Stake All HVN ‚Üí sHVN</button>
            </div>
        </div>
        
        <!-- Your Positions -->
        <div class="positions">
            <h3>üìä Your Active Positions</h3>
            <div id="positionsList">
                <p style="color: #666;">No active positions yet</p>
            </div>
        </div>
        
        <!-- Treasury Status -->
        <div class="treasury">
            <h2>üèõÔ∏è Blackhaven Treasury</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total Value</div>
                    <div class="stat-value">$<span id="treasuryTotal">0</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">MEGA Locked</div>
                    <div class="stat-value">$<span id="megaLocked">0</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">RBT Backing</div>
                    <div class="stat-value">$<span id="rbtBacking">1.00</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Monthly Yield</div>
                    <div class="stat-value">$<span id="monthlyYield">0</span></div>
                </div>
            </div>
            
            <h4 style="margin-top: 20px; color: #4ade80;">Treasury Composition</h4>
            <div class="balance-row">
                <span>MEGA (Staked in Sequencer)</span>
                <span class="balance-value"><span id="treasuryMega">0</span> MEGA</span>
            </div>
            <div class="balance-row">
                <span>USDM (From HPN)</span>
                <span class="balance-value"><span id="treasuryUsdm">0</span> USDM</span>
            </div>
            <div class="balance-row">
                <span>Protocol Owned Liquidity</span>
                <span class="balance-value">$<span id="treasuryPOL">0</span></span>
            </div>
        </div>
        
        <!-- Results Modal -->
        <div id="resultModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h3 id="modalTitle">Transaction Result</h3>
                <p id="modalContent"></p>
                <button class="button" onclick="closeModal()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            day: 0,
            // User balances
            usdm: 100000,
            mega: 10000,
            hvn: 0,
            sHvn: 0,
            rbt: 0,
            
            // Prices
            megaPrice: 10,
            hvnPrice: 1.00,
            hvnBLV: 0.90,
            rbtBacking: 1.00,
            
            // Treasury
            treasuryMega: 0,
            treasuryUsdm: 0,
            treasuryPOL: 0,
            treasuryTotal: 0,
            
            // Positions
            positions: [],
            
            // Stats
            totalRBTSupply: 0,
            monthlyYield: 0
        };
        
        function updateUI() {
            // Update wallet
            document.getElementById('usdmBalance').textContent = formatNumber(gameState.usdm);
            document.getElementById('megaBalance').textContent = formatNumber(gameState.mega);
            document.getElementById('hvnBalance').textContent = formatNumber(gameState.hvn);
            document.getElementById('rbtBalance').textContent = formatNumber(gameState.rbt);
            
            // Update prices
            document.getElementById('hvnPrice').textContent = gameState.hvnPrice.toFixed(2);
            document.getElementById('hvnBLV').textContent = gameState.hvnBLV.toFixed(2);
            document.getElementById('rbtBacking').textContent = gameState.rbtBacking.toFixed(2);
            
            // Update treasury
            document.getElementById('treasuryTotal').textContent = formatNumber(gameState.treasuryTotal);
            document.getElementById('megaLocked').textContent = formatNumber(gameState.treasuryMega * gameState.megaPrice);
            document.getElementById('treasuryMega').textContent = formatNumber(gameState.treasuryMega);
            document.getElementById('treasuryUsdm').textContent = formatNumber(gameState.treasuryUsdm);
            document.getElementById('treasuryPOL').textContent = formatNumber(gameState.treasuryPOL);
            document.getElementById('monthlyYield').textContent = formatNumber(gameState.monthlyYield);
            
            // Update day
            document.getElementById('currentDay').textContent = gameState.day;
            
            // Update positions
            updatePositionsList();
        }
        
        function formatNumber(num) {
            return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }
        
        function addEvent(message) {
            const eventsDiv = document.getElementById('events');
            const event = document.createElement('div');
            event.className = 'event';
            event.textContent = `Day ${gameState.day}: ${message}`;
            eventsDiv.insertBefore(event, eventsDiv.firstChild);
            
            // Keep only last 10 events
            while (eventsDiv.children.length > 10) {
                eventsDiv.removeChild(eventsDiv.lastChild);
            }
        }
        
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('resultModal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }
        
        function createHPN() {
            const amount = parseFloat(document.getElementById('hpnAmount').value);
            const term = parseInt(document.getElementById('hpnTerm').value);
            
            if (amount > gameState.usdm) {
                showModal('Insufficient Funds', 'You don\'t have enough USDM!');
                return;
            }
            
            const apy = term === 90 ? 0.08 : term === 180 ? 0.12 : 0.15;
            
            gameState.usdm -= amount;
            gameState.treasuryUsdm += amount;
            
            const position = {
                type: 'HPN',
                id: Date.now(),
                amount: amount,
                startDay: gameState.day,
                endDay: gameState.day + term,
                apy: apy,
                accumulated: 0,
                megaPoints: 0
            };
            
            gameState.positions.push(position);
            
            addEvent(`Created HPN position: ${formatNumber(amount)} USDM for ${term} days`);
            showModal('HPN Created!', 
                `You deposited ${formatNumber(amount)} USDM<br>` +
                `Term: ${term} days<br>` +
                `APY: ${(apy * 100).toFixed(0)}%<br>` +
                `<br>You received an NFT representing your position!`
            );
            
            updateTreasury();
            updateUI();
        }
        
        function createBond() {
            const asset = document.getElementById('bondAsset').value;
            const amount = parseFloat(document.getElementById('bondAmount').value);
            const vesting = parseInt(document.getElementById('bondVesting').value);
            
            const balance = asset === 'usdm' ? gameState.usdm : gameState.mega;
            if (amount > balance) {
                showModal('Insufficient Funds', `You don\'t have enough ${asset.toUpperCase()}!`);
                return;
            }
            
            const discount = vesting === 7 ? 0.05 : vesting === 30 ? 0.10 : 0.15;
            const value = asset === 'usdm' ? amount : amount * gameState.megaPrice;
            const rbtAmount = value / gameState.rbtBacking / (1 - discount);
            
            if (asset === 'usdm') {
                gameState.usdm -= amount;
                gameState.treasuryUsdm += amount;
            } else {
                gameState.mega -= amount;
                gameState.treasuryMega += amount;
            }
            
            const position = {
                type: 'Bond',
                id: Date.now(),
                asset: asset,
                amount: amount,
                rbtAmount: rbtAmount,
                startDay: gameState.day,
                vestingDays: vesting,
                vested: 0,
                discount: discount
            };
            
            gameState.positions.push(position);
            gameState.totalRBTSupply += rbtAmount;
            
            addEvent(`Created Bond: ${formatNumber(amount)} ${asset.toUpperCase()} for ${formatNumber(rbtAmount)} RBT`);
            showModal('Bond Created!', 
                `You bonded ${formatNumber(amount)} ${asset.toUpperCase()}<br>` +
                `You will receive ${formatNumber(rbtAmount)} RBT<br>` +
                `Discount: ${(discount * 100).toFixed(0)}%<br>` +
                `Vesting: ${vesting} days`
            );
            
            updateTreasury();
            updateUI();
        }
        
        function buyHVN() {
            const amount = parseFloat(document.getElementById('hvnBuyAmount').value);
            
            if (amount > gameState.usdm) {
                showModal('Insufficient Funds', 'You don\'t have enough USDM!');
                return;
            }
            
            const hvnAmount = amount / gameState.hvnPrice;
            
            gameState.usdm -= amount;
            gameState.hvn += hvnAmount;
            
            // Simulate Baseline market impact
            gameState.hvnBLV += amount * 0.00001; // BLV grows with trading
            gameState.hvnPrice += amount * 0.00002; // Price impact
            
            addEvent(`Bought ${formatNumber(hvnAmount)} HVN for ${formatNumber(amount)} USDM`);
            showModal('HVN Purchased!', 
                `You bought ${formatNumber(hvnAmount)} HVN<br>` +
                `Price: $${gameState.hvnPrice.toFixed(2)}<br>` +
                `BLV (floor): $${gameState.hvnBLV.toFixed(2)}<br>` +
                `<br>Remember: You can never sell below BLV!`
            );
            
            updateUI();
        }
        
        function stakeHVN() {
            if (gameState.hvn <= 0) {
                showModal('No HVN', 'You don\'t have any HVN to stake!');
                return;
            }
            
            const amount = gameState.hvn;
            gameState.hvn = 0;
            gameState.sHvn += amount;
            
            const position = {
                type: 'sHVN',
                id: Date.now(),
                amount: amount,
                startDay: gameState.day,
                rewards: 0
            };
            
            gameState.positions.push(position);
            
            addEvent(`Staked ${formatNumber(amount)} HVN ‚Üí sHVN`);
            showModal('HVN Staked!', 
                `You staked ${formatNumber(amount)} HVN<br>` +
                `You now have ${formatNumber(amount)} sHVN<br>` +
                `<br>sHVN earns rewards from treasury growth!`
            );
            
            updateUI();
        }
        
        function updatePositionsList() {
            const container = document.getElementById('positionsList');
            
            if (gameState.positions.length === 0) {
                container.innerHTML = '<p style="color: #666;">No active positions yet</p>';
                return;
            }
            
            container.innerHTML = gameState.positions.map(pos => {
                let html = '<div class="position-item">';
                html += '<div class="position-header">';
                
                if (pos.type === 'HPN') {
                    const daysLeft = pos.endDay - gameState.day;
                    const yield = pos.accumulated;
                    html += `<span><span class="tag tag-hpn">HPN</span> ${formatNumber(pos.amount)} USDM</span>`;
                    html += `<span>${daysLeft > 0 ? daysLeft + ' days left' : 'Matured'}</span>`;
                    html += `</div><div class="position-details">`;
                    html += `Yield: $${formatNumber(yield)} | MEGA Points: ${formatNumber(pos.megaPoints)}`;
                    if (daysLeft <= 0) {
                        html += ` | <button class="button" style="width: auto; padding: 5px 10px;" onclick="claimHPN(${pos.id})">Claim</button>`;
                    }
                } else if (pos.type === 'Bond') {
                    const progress = Math.min(100, ((gameState.day - pos.startDay) / pos.vestingDays) * 100);
                    const vested = pos.rbtAmount * progress / 100;
                    html += `<span><span class="tag tag-bond">BOND</span> ${formatNumber(pos.rbtAmount)} RBT</span>`;
                    html += `<span>${progress.toFixed(0)}% vested</span>`;
                    html += `</div><div class="position-details">`;
                    html += `Vested: ${formatNumber(vested)} RBT | ${pos.vestingDays - (gameState.day - pos.startDay)} days left`;
                    if (progress >= 100) {
                        html += ` | <button class="button" style="width: auto; padding: 5px 10px;" onclick="claimBond(${pos.id})">Claim</button>`;
                    }
                } else if (pos.type === 'sHVN') {
                    html += `<span><span class="tag tag-hvn">sHVN</span> ${formatNumber(pos.amount)} sHVN</span>`;
                    html += `<span>+${formatNumber(pos.rewards)} rewards</span>`;
                    html += `</div><div class="position-details">`;
                    html += `Staked on day ${pos.startDay} | Earning treasury rewards`;
                }
                
                html += '</div></div>';
                return html;
            }).join('');
        }
        
        function claimHPN(posId) {
            const pos = gameState.positions.find(p => p.id === posId);
            if (!pos || pos.type !== 'HPN') return;
            
            gameState.usdm += pos.amount + pos.accumulated;
            gameState.treasuryUsdm -= pos.amount;
            
            // Convert MEGA points
            const megaFromPoints = pos.megaPoints / 1000; // 1000 points = 1 MEGA
            gameState.mega += megaFromPoints;
            
            gameState.positions = gameState.positions.filter(p => p.id !== posId);
            
            addEvent(`Claimed HPN: ${formatNumber(pos.amount + pos.accumulated)} USDM + ${formatNumber(megaFromPoints)} MEGA`);
            showModal('HPN Claimed!', 
                `Principal returned: ${formatNumber(pos.amount)} USDM<br>` +
                `Yield earned: ${formatNumber(pos.accumulated)} USDM<br>` +
                `MEGA from points: ${formatNumber(megaFromPoints)}<br>` +
                `<br>Total received: ${formatNumber(pos.amount + pos.accumulated)} USDM`
            );
            
            updateTreasury();
            updateUI();
        }
        
        function claimBond(posId) {
            const pos = gameState.positions.find(p => p.id === posId);
            if (!pos || pos.type !== 'Bond') return;
            
            gameState.rbt += pos.rbtAmount;
            gameState.positions = gameState.positions.filter(p => p.id !== posId);
            
            addEvent(`Claimed Bond: ${formatNumber(pos.rbtAmount)} RBT`);
            showModal('Bond Claimed!', 
                `You received ${formatNumber(pos.rbtAmount)} RBT<br>` +
                `Current backing: $${gameState.rbtBacking.toFixed(2)} per RBT`
            );
            
            updateUI();
        }
        
        function updateTreasury() {
            gameState.treasuryTotal = 
                (gameState.treasuryMega * gameState.megaPrice) + 
                gameState.treasuryUsdm + 
                gameState.treasuryPOL;
            
            if (gameState.totalRBTSupply > 0) {
                gameState.rbtBacking = gameState.treasuryTotal / gameState.totalRBTSupply;
            }
            
            // Calculate monthly yield
            const megaStaking = gameState.treasuryMega * gameState.megaPrice * 0.15 / 12; // 15% APY
            const usdmYield = gameState.treasuryUsdm * 0.12 / 12; // 12% APY
            gameState.monthlyYield = megaStaking + usdmYield;
        }
        
        function advanceTime(days) {
            const startDay = gameState.day;
            gameState.day += days;
            
            // Process each day
            for (let d = startDay + 1; d <= gameState.day; d++) {
                // MEGA price appreciation (random but trending up)
                const priceChange = (Math.random() - 0.3) * 0.02; // -1% to +3% daily
                gameState.megaPrice *= (1 + priceChange);
                
                // HVN BLV growth (always up)
                gameState.hvnBLV *= 1.0003; // 0.03% daily
                
                // HVN price movement
                gameState.hvnPrice *= (1 + (Math.random() - 0.4) * 0.01);
                if (gameState.hvnPrice < gameState.hvnBLV) {
                    gameState.hvnPrice = gameState.hvnBLV * 1.01; // Can't go below BLV
                }
                
                // Process positions
                gameState.positions.forEach(pos => {
                    if (pos.type === 'HPN' && d <= pos.endDay) {
                        const dailyYield = pos.amount * pos.apy / 365;
                        pos.accumulated += dailyYield;
                        pos.megaPoints += 100; // 100 points per day per 10k USDM
                    } else if (pos.type === 'sHVN') {
                        // Earn share of treasury growth
                        if (gameState.sHvn > 0) {
                            pos.rewards += (gameState.monthlyYield / 30) * (pos.amount / gameState.sHvn) * 0.4; // 40% to stakers
                        }
                    }
                });
            }
            
            addEvent(`Advanced ${days} days. MEGA price: $${gameState.megaPrice.toFixed(2)}`);
            updateTreasury();
            updateUI();
        }
        
        function resetSimulation() {
            if (!confirm('Are you sure you want to reset the simulation?')) return;
            
            gameState = {
                day: 0,
                usdm: 100000,
                mega: 10000,
                hvn: 0,
                sHvn: 0,
                rbt: 0,
                megaPrice: 10,
                hvnPrice: 1.00,
                hvnBLV: 0.90,
                rbtBacking: 1.00,
                treasuryMega: 0,
                treasuryUsdm: 0,
                treasuryPOL: 0,
                treasuryTotal: 0,
                positions: [],
                totalRBTSupply: 0,
                monthlyYield: 0
            };
            
            document.getElementById('events').innerHTML = '<div class="event">Simulation started</div>';
            updateUI();
        }
        
        // Initialize
        updateUI();
        
        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('resultModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
